<?xml version="1.0" encoding="utf-8" standalone="no" ?>
<modDesc descVersion="105">
    <!--
         modDesc.xml is the entry point for all FS25 mods
         This file defines metadata, localization, GUI, and script loading order
         Order of script loading is CRITICAL - dependencies must load first
    -->

    <author>UsedPlus Team</author>
    <version>2.7.2.0</version>

    <title>
        <en>UsedPlus - Finance &amp; Marketplace System</en>
        <de>UsedPlus - Finanzierungs- Und Marktsystem</de>
    </title>

    <description>
        <en><![CDATA[
UsedPlus adds comprehensive financing, leasing, and a used vehicle marketplace to Farming Simulator 25.

FINANCE SYSTEM
- Finance vehicles, equipment, and land with 1-30 year terms
- Dynamic credit scoring (300-850) based on payment history and debt ratio
- Interest rates adjust based on your credit score
- Take general cash loans against your farm's collateral

LEASING
- Lease vehicles with flexible 1-5 year terms
- Buyout options at end of lease
- Land leasing with markup rates by term length

USED VEHICLE MARKETPLACE
- Search for used equipment through 3 agent tiers (Local/Regional/National)
- Inspect vehicles before purchase to reveal hidden condition
- Negotiate prices with AI sellers (weather affects deals!)
- Sell your vehicles through agents for better prices than trade-in

MAINTENANCE & REPAIR
- Partial repair system (1-100%) at any workshop
- Field Service Kit for emergency roadside repairs
- OBD Scanner with diagnosis minigame
- Integration with RVB and UYT mods

ADDITIONAL FEATURES
- ESC menu Finance Manager (Shift+F)
- Trade-in system with condition-based values
- Full multiplayer support
- 10 language translations
- Configurable settings for all systems

See CHANGELOG.md for version history.
        ]]></en>
        <de><![CDATA[
UsedPlus fügt umfassende Finanzierung, Leasing und einen Gebrauchtfahrzeugmarkt zu Farming Simulator 25 hinzu.

FINANZSYSTEM
- Fahrzeuge, Geräte und Land mit 1-30 Jahren Laufzeit finanzieren
- Dynamische Bonitätsbewertung (300-850) basierend auf Zahlungsverhalten
- Zinssätze passen sich der Kreditwürdigkeit an
- Allgemeine Kredite gegen Sicherheiten aufnehmen

LEASING
- Fahrzeuge mit flexiblen 1-5 Jahres-Konditionen leasen
- Kaufoptionen am Ende der Leasingzeit
- Landpacht mit gestaffelten Aufschlägen

GEBRAUCHTFAHRZEUGMARKT
- Gebrauchte Geräte über 3 Agentenstufen suchen
- Fahrzeuge vor dem Kauf inspizieren
- Preise mit KI-Verkäufern verhandeln (Wetter beeinflusst Deals!)
- Fahrzeuge über Agenten verkaufen für bessere Preise

WARTUNG & REPARATUR
- Teilreparatursystem (1-100%) in jeder Werkstatt
- Pannenset für Notfall-Reparaturen
- OBD-Scanner mit Diagnose-Minispiel
- Integration mit RVB und UYT Mods

WEITERE FUNKTIONEN
- ESC-Menü Finanzmanager (Umschalt+F)
- Inzahlungnahme mit zustandsbasierten Werten
- Vollständige Multiplayer-Unterstützung
- 10 Sprachübersetzungen
- Konfigurierbare Einstellungen

Siehe CHANGELOG.md für Versionshistorie.
        ]]></de>
    </description>

    <iconFilename>icon_UsedPlus.dds</iconFilename>
    <multiplayer supported="true"/>

    <!--
         Localization files loaded via prefix pattern
         Game looks for translation_en.xml, translation_de.xml, etc.
    -->
    <l10n filenamePrefix="translations/translation"/>

    <!--
         Input actions for opening finance manager from ESC or in-game
         Pattern from: EnhancedLoanSystem, BuyUsedEquipment
    -->
    <!-- v2.0.3: Separated actions and inputBinding for proper on-foot player actions -->
    <!-- Pattern from: FS25_CutOpenBale which works for on-foot keybinds -->
    <actions>
        <action name="USEDPLUS_OPEN_FINANCE_MANAGER" category="ONFOOT VEHICLE" axisType="HALF"/>
        <action name="USEDPLUS_SEARCH_USED" category="MENU" axisType="HALF"/>
        <action name="USEDPLUS_INSPECT_VEHICLE" category="MENU" axisType="HALF"/>
        <action name="USEDPLUS_ACTIVATE_OBD" category="ONFOOT" axisType="HALF"/>
        <action name="USEDPLUS_TIRES" category="MENU" axisType="HALF"/>
    </actions>

    <inputBinding>
        <actionBinding action="USEDPLUS_OPEN_FINANCE_MANAGER">
            <binding device="KB_MOUSE_DEFAULT" input="KEY_lshift KEY_f"/>
        </actionBinding>
        <actionBinding action="USEDPLUS_SEARCH_USED">
            <binding device="KB_MOUSE_DEFAULT" input="KEY_u"/>
        </actionBinding>
        <actionBinding action="USEDPLUS_INSPECT_VEHICLE">
            <binding device="KB_MOUSE_DEFAULT" input="KEY_i"/>
        </actionBinding>
        <actionBinding action="USEDPLUS_ACTIVATE_OBD">
            <binding device="KB_MOUSE_DEFAULT" input="KEY_o"/>
        </actionBinding>
        <actionBinding action="USEDPLUS_TIRES">
            <binding device="KB_MOUSE_DEFAULT" input="KEY_t"/>
        </actionBinding>
    </inputBinding>

    <!--
         GUI XML definitions for ESC menu screens only
         Shop dialogs are loaded dynamically on first use
         DISABLED temporarily - need to fix XML structure
    -->
    <!--
    <gui>
        <gui xmlFilename="gui/FinanceManagerFrame.xml" />
        <gui xmlFilename="gui/FinanceDetailFrame.xml" />
    </gui>
    -->

    <!--
         Script loading order is CRITICAL
         Pattern: Data classes → Utils → Events → Managers → Extensions → GUI → Main
         Dependencies MUST load before dependents
    -->
    <extraSourceFiles>
        <!-- MUST LOAD FIRST: Core module defines UsedPlus global and logging -->
        <sourceFile filename="src/core/UsedPlusCore.lua"/>

        <!-- Core utilities (depend on UsedPlusCore) -->
        <sourceFile filename="src/utils/DealUtils.lua"/>  <!-- Deal interface contract and helpers -->
        <sourceFile filename="src/utils/ModCompatibility.lua"/>  <!--  v1.8.0: RVB/UYT cross-mod integration -->

        <!-- Data classes (depend on DealUtils) -->
        <sourceFile filename="src/data/CreditSystem.lua"/>  <!-- Consolidated: CreditScore + CreditHistory -->
        <sourceFile filename="src/data/FinanceDeal.lua"/>
        <sourceFile filename="src/data/LeaseDeal.lua"/>
        <sourceFile filename="src/data/LandLeaseDeal.lua"/>  <!--  Land leasing -->
        <sourceFile filename="src/data/UsedVehicleSearch.lua"/>
        <sourceFile filename="src/data/VehicleSaleListing.lua"/>  <!--  Agent-based vehicle sales -->
        <sourceFile filename="src/data/DiagnosisData.lua"/>       <!--  v1.8.0: Field Service Kit diagnosis data -->

        <!-- Settings system (load before managers) -->
        <sourceFile filename="src/settings/SettingsPresets.lua"/>    <!--  v1.4.0: Preset configurations -->
        <sourceFile filename="src/settings/UsedPlusSettings.lua"/>   <!--  v1.4.0: Settings manager singleton -->

        <!-- Utility classes (no dependencies except data classes) -->
        <sourceFile filename="src/utils/FinanceCalculations.lua"/>
        <sourceFile filename="src/utils/DepreciationCalculations.lua"/>
        <sourceFile filename="src/utils/ConfigurationDetector.lua"/>
        <sourceFile filename="src/utils/TradeInCalculations.lua"/>

        <!-- UI utilities (depend on utils, used by GUI) -->
        <sourceFile filename="src/utils/UIHelper.lua"/>       <!--  Centralized UI formatting -->
        <sourceFile filename="src/utils/UsedPlusUI.lua"/>     <!--  UI component system -->
        <sourceFile filename="src/utils/DialogLoader.lua"/>   <!--  Centralized dialog loading -->
        <sourceFile filename="src/utils/UsedPlusAPI.lua"/>    <!--  v2.5.2: Public API for external mod integration -->
        <sourceFile filename="src/utils/NetworkSecurity.lua"/> <!--  v2.7.2: Multiplayer security validation -->

        <!-- Vehicle Specialization - Maintenance System (v2.7.2 Modular) -->
        <!-- IMPORTANT: Modules must load BEFORE core spec, core BEFORE register -->
        <!-- Modules attach functions to UsedPlusMaintenance namespace -->
        <sourceFile filename="src/specializations/maintenance/MaintenanceConfig.lua"/>
        <sourceFile filename="src/specializations/maintenance/MaintenanceWarnings.lua"/>
        <sourceFile filename="src/specializations/maintenance/MaintenanceSpeed.lua"/>
        <sourceFile filename="src/specializations/maintenance/MaintenanceTires.lua"/>
        <sourceFile filename="src/specializations/maintenance/MaintenanceFluids.lua"/>
        <sourceFile filename="src/specializations/maintenance/MaintenanceReliability.lua"/>
        <sourceFile filename="src/specializations/maintenance/MaintenanceEngine.lua"/>
        <sourceFile filename="src/specializations/maintenance/MaintenanceSteering.lua"/>
        <sourceFile filename="src/specializations/maintenance/MaintenanceHydraulics.lua"/>
        <!-- Core specialization (uses functions from modules above) -->
        <sourceFile filename="src/specializations/UsedPlusMaintenance.lua"/>
        <sourceFile filename="src/specializations/UsedPlusMaintenanceRegister.lua"/>

        <!-- Network events (depend on data classes) - CONSOLIDATED -->
        <sourceFile filename="src/events/FinanceEvents.lua"/>    <!-- FinanceVehicleEvent, FinancePaymentEvent, TakeLoanEvent -->
        <sourceFile filename="src/events/LeaseEvents.lua"/>      <!-- LeaseVehicleEvent, LeaseEndEvent, TerminateLeaseEvent -->
        <sourceFile filename="src/events/LandEvents.lua"/>       <!-- LandLeaseEvent, LandLeaseBuyoutEvent -->
        <sourceFile filename="src/events/SaleEvents.lua"/>       <!-- CreateSaleListingEvent, SaleListingActionEvent -->
        <sourceFile filename="src/events/UsedMarketEvents.lua"/> <!-- RequestUsedItemEvent, UsedItemFoundEvent -->
        <sourceFile filename="src/events/RepairVehicleEvent.lua"/>
        <sourceFile filename="src/events/SetPaymentConfigEvent.lua"/>  <!-- Payment configuration sync -->
        <sourceFile filename="src/events/UsedPlusSettingsEvent.lua"/>  <!--  v1.4.0: Settings sync event -->

        <!-- Manager classes (depend on data classes, utils, events) -->
        <sourceFile filename="src/managers/FinanceManager.lua"/>
        <!-- UsedVehicleManager Modules (v2.7.2 Modular) -->
        <!-- IMPORTANT: Modules must load BEFORE core manager -->
        <!-- Modules attach functions to UsedVehicleManager namespace -->
        <sourceFile filename="src/managers/usedvehicle/VehicleSearchSystem.lua"/>
        <sourceFile filename="src/managers/usedvehicle/VehicleSpawning.lua"/>
        <sourceFile filename="src/managers/usedvehicle/VehicleInspection.lua"/>
        <sourceFile filename="src/managers/usedvehicle/VehiclePersistence.lua"/>
        <!-- Core manager (uses functions from modules above) -->
        <sourceFile filename="src/managers/UsedVehicleManager.lua"/>
        <sourceFile filename="src/managers/VehicleSaleManager.lua"/>  <!--  Agent-based vehicle sales -->
        <sourceFile filename="src/managers/DifficultyScalingManager.lua"/>  <!--  v2.0.0: Farmland difficulty scaling (GMNGjoy pattern) -->
        <sourceFile filename="src/managers/BankInterestManager.lua"/>  <!--  v2.0.0: Bank interest on cash (Evan Kirsch pattern) -->

        <!-- GUI screens (depend on managers) -->
        <sourceFile filename="src/gui/LeaseEndDialog.lua"/>  <!--  Lease end options -->
        <sourceFile filename="src/gui/LeaseRenewalDialog.lua"/>  <!--  Lease renewal/buyout/return dialog -->
        <sourceFile filename="src/gui/UsedSearchDialog.lua"/>
        <!-- FinanceManagerFrame Panels (v2.7.2 Modular) -->
        <!-- IMPORTANT: Panels must load BEFORE core frame -->
        <!-- Panels attach functions to FinanceManagerFrame namespace -->
        <sourceFile filename="src/gui/financepanels/FinancesPanel.lua"/>
        <sourceFile filename="src/gui/financepanels/SearchesPanel.lua"/>
        <sourceFile filename="src/gui/financepanels/SalesPanel.lua"/>
        <!-- Core frame (uses functions from panel modules) -->
        <sourceFile filename="src/gui/FinanceManagerFrame.lua"/>
        <sourceFile filename="src/gui/FinanceDetailFrame.lua"/>
        <sourceFile filename="src/gui/RepairDialog.lua"/>
        <sourceFile filename="src/gui/RepairFinanceDialog.lua"/>
        <sourceFile filename="src/gui/TiresDialog.lua"/>      <!--  v1.7.0: Tire replacement dialog -->
        <sourceFile filename="src/gui/FluidsDialog.lua"/>     <!--  v1.7.0: Fluids service dialog -->
        <sourceFile filename="src/gui/TakeLoanDialog.lua"/>
        <sourceFile filename="src/gui/LoanApprovedDialog.lua"/>  <!--  Styled loan confirmation popup -->
        <sourceFile filename="src/gui/FinancialDashboard.lua"/>
        <sourceFile filename="src/gui/CreditReportDialog.lua"/>  <!--  Detailed credit report -->
        <sourceFile filename="src/gui/SellVehicleDialog.lua"/>   <!--  Agent-based vehicle sales -->
        <sourceFile filename="src/gui/SaleOfferDialog.lua"/>     <!--  Accept/Decline sale offers -->
        <sourceFile filename="src/gui/UnifiedPurchaseDialog.lua"/>  <!--  Unified Buy/Finance/Lease dialog -->
        <sourceFile filename="src/gui/UnifiedLandPurchaseDialog.lua"/>  <!--  Land Buy/Finance/Lease dialog -->
        <sourceFile filename="src/gui/DealDetailsDialog.lua"/>    <!--  Finance/Lease deal details popup -->
        <sourceFile filename="src/gui/PaymentHistoryDialog.lua"/>  <!--  Full amortization schedule view -->
        <sourceFile filename="src/gui/SaleListingDetailsDialog.lua"/>  <!--  Sale listing details popup -->
        <sourceFile filename="src/gui/SearchDetailsDialog.lua"/>  <!--  Used search details popup -->
        <sourceFile filename="src/gui/UsedVehiclePreviewDialog.lua"/>  <!--  Used vehicle inspection preview -->
        <sourceFile filename="src/gui/InspectionReportDialog.lua"/>  <!--  Inspection report with reliability bars -->
        <sourceFile filename="src/gui/MaintenanceReportDialog.lua"/>  <!--  Maintenance report for owned vehicles -->
        <sourceFile filename="src/gui/VehiclePortfolioDialog.lua"/>  <!--  v1.5.0: Portfolio browser for multi-find agent model -->
        <sourceFile filename="src/gui/SearchInitiatedDialog.lua"/>  <!--  v1.5.0: Styled search confirmation -->
        <sourceFile filename="src/gui/SaleListingInitiatedDialog.lua"/>  <!--  v1.5.0: Styled sale listing confirmation -->
        <sourceFile filename="src/gui/SearchExpiredDialog.lua"/>       <!--  v1.5.1: Search expiration with renewal option -->
        <sourceFile filename="src/gui/SaleExpiredDialog.lua"/>          <!--  v1.5.1: No buyer found dialog -->
        <sourceFile filename="src/gui/FieldServiceKitDialog.lua"/>    <!--  v1.8.0: Field Service Kit dialog -->
        <sourceFile filename="src/gui/FluidPurchaseDialog.lua"/>    <!--  v1.9.3: Fluid purchase dialog -->
        <sourceFile filename="src/gui/RepossessionDialog.lua"/>    <!--  v1.9.8: Repossession notification dialog -->
        <sourceFile filename="src/gui/NegotiationDialog.lua"/>    <!--  v2.6.0: Used vehicle negotiation dialog -->
        <sourceFile filename="src/gui/SellerResponseDialog.lua"/>    <!--  v2.6.0: Seller response dialog -->
        <sourceFile filename="src/gui/UsedPlusSettingsMenuExtension.lua"/>  <!--  v1.4.0: Game Settings integration -->

        <!-- Extensions (depend on managers, GUI) -->
        <sourceFile filename="src/extensions/ShopConfigScreenExtension.lua"/>
        <sourceFile filename="src/extensions/BuyVehicleDataExtension.lua"/>
        <sourceFile filename="src/extensions/FarmExtension.lua"/>
        <sourceFile filename="src/extensions/FarmlandManagerExtension.lua"/>
        <sourceFile filename="src/extensions/VehicleExtension.lua"/>
        <sourceFile filename="src/extensions/InGameMenuMapFrameExtension.lua"/>
        <sourceFile filename="src/extensions/VehicleSellingPointExtension.lua"/>
        <sourceFile filename="src/extensions/InGameMenuVehiclesFrameExtension.lua"/>  <!--  Hook ESC Vehicles Sell button -->
        <sourceFile filename="src/extensions/WorkshopScreenExtension.lua"/>  <!--  Hook Workshop Inspect button -->
        <sourceFile filename="src/extensions/RVBWorkshopIntegration.lua"/>  <!--  v2.1.0: RVB Workshop cross-mod integration -->
        <sourceFile filename="src/extensions/FinanceMenuExtension.lua"/>  <!--  Disable vanilla borrow, require credit-based loans -->

        <!-- Main entry point (MUST be last - depends on everything) -->
        <sourceFile filename="src/main.lua"/>
    </extraSourceFiles>

    <!-- Vehicle Specializations - Hand Tools -->
    <specializations>
        <specialization name="FieldServiceKit" className="FieldServiceKit" filename="vehicles/FieldServiceKit.lua"/>
    </specializations>

    <!-- Vehicle Types - Portable Tools -->
    <!-- Field Service Kit: Uses parent="base" like MobileServiceKit pattern -->
    <!-- Specializations within same mod do NOT need mod prefix -->
    <vehicleTypes>
        <type name="usedPlusFieldServiceKit" parent="base" filename="$dataS/scripts/vehicles/Vehicle.lua">
            <specialization name="FieldServiceKit"/>
        </type>
    </vehicleTypes>

    <!-- Placeable Specializations -->
    <placeableSpecializations>
        <specialization name="OilServicePoint" className="OilServicePoint" filename="placeables/OilServicePoint.lua"/>
    </placeableSpecializations>

    <!-- Placeable Types using our specializations -->
    <placeableTypes>
        <type name="usedPlusOilServicePoint" parent="simplePlaceable" filename="$dataS/scripts/placeables/Placeable.lua">
            <specialization name="OilServicePoint"/>
        </type>
    </placeableTypes>

    <!-- Placeables & Hand Tools -->
    <storeItems>
        <storeItem xmlFilename="placeables/OilTank.xml"/>
        <storeItem xmlFilename="vehicles/fieldServiceKit/fieldServiceKit.xml"/>  <!--  v1.8.0: Field Service Kit -->
    </storeItems>
</modDesc>
